# syntax=docker/dockerfile:1.6
FROM python:3.11-slim
ENV PYTHONDONTWRITEBYTECODE=1 PYTHONUNBUFFERED=1 PIP_NO_CACHE_DIR=1
WORKDIR /app
COPY k8s/services/prep/requirements.txt requirements.txt
RUN pip install --upgrade pip && pip install -r requirements.txt
COPY src/train_svc /app/src/train_svc
COPY src/common /app/src/common

RUN useradd -m appuser && chown -R appuser:appuser /app
USER appuser
EXPOSE 8080
CMD ["gunicorn","-k","uvicorn.workers.UvicornWorker","-w","2","-b","0.0.0.0:8080","src.train_svc.app:app","--keep-alive","30","--timeout","120"]
